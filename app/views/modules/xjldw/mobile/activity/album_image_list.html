<!DOCTYPE HTML>
<html ng-app="app">
<head>
<meta charset="UTF-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport"content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no,minimal-ui"/>
<meta content="yes" name="apple-mobile-web-app-capable" />
<meta content="yes" name="apple-touch-fullscreen" />
<meta content="telephone=no" name="format-detection" />
<meta content="black" name="apple-mobile-web-app-status-bar-style" />
<link rel="stylesheet" href="/public/css/main.css" />
<link rel="stylesheet" href="/public/css/weui.css">
<script src="/public/widgets/layer.m/layer.m.js"></script>
<script src="/public/widgets/zeptojs/zepto.min.js"></script>
<script src="/public/widgets/dropload/dropload.min.js"></script>
<script src="/public/widgets/angularjs/angular.min.js"></script>
<script src="/public/widgets/angularjs/angular-touch.min.js"></script>
</head>
<script type="text/javascript">
angular.module('app', ['ngTouch'])
.value('appValue', {
    index: 1,
    size: 10
})
.factory('agentRemote',['$http','appValue',function($http, appValue){
		return {
			getData:function(index,size,searchText){
				return $http({
					method:'GET',
					url:'/mobile/ActivityService/queryAlbumImageList',
					params:{
						PAGE_INDEX: index || appValue.index,
                         PAGE_SIZE: size || appValue.size,
                         albumId:'${albumId}'
					}
				});
			}
			
		}
}])
.controller('MainController',['$scope','appValue','agentRemote','$timeout',function($scope, appValue, agentRemote,$timeout){
			 $scope.lists = [];
			 $scope.nextPage = function(me){
				 agentRemote.getData(++appValue.index).then(function(response){
					 $scope.lists = $scope.lists.concat(response.data.data.data);
					 if (me && me.resetload)
                         me.resetload();
				 },function(response){
					 
				 })
			 };
			 //init page function
			   $scope.initPage = function (me) {
				   appValue.index = 1;
		            agentRemote.getData(1).then(function (response) {
                        $scope.total = response.data.data.total;
                        $scope.lists = response.data.data.data;
                        console.log($scope.lists);
                        if (me && me.resetload)
                            me.resetload();

                    }, function (response) {
                        //err
                    });
			 };
			 $scope.initPage();
			 loadShow();
}])
</script>
<body ng-cloak ng-controller="MainController">
<div class="page">
    <div class="page__bd">
        <div class="weui-gallery" id="gallery"> 
            <span class="weui-gallery__img" id="galleryImg"></span>
            <div class="weui-gallery__opr">
                <!-- <a href="javascript:" class="weui-gallery__del">
                    <i class="weui-icon-delete weui-icon_gallery-delete"></i>
                </a> -->
            </div>
        </div>
        <div class="weui-cells weui-cells_form">
            <div class="weui-cell">
                <div class="weui-cell__bd">
                    <div class="weui-uploader">
                        <div class="weui-uploader__bd" id="uploaderFiles"  ng-show="lists.length!=0">
                            <ul class="weui-uploader__files"  ng-repeat="image in lists">
                                <li class="weui-uploader__file" style="background-image:url({{image.fileUrl}})" ></li> 
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
   <!--  <div class="page__ft">
        <a href="javascript:home()"><img src="./images/icon_footer_link.png" /></a>
    </div> -->
</div>
</body>
<script type="text/javascript">
function loadShow(){
	  var tmpl = '<li class="weui-uploader__file" style="background-image:url(url)"></li>',
      $gallery = $("#gallery"), $galleryImg = $("#galleryImg"),
      $uploaderFiles = $("#uploaderFiles");
	  $uploaderFiles.on("click", "li", function(){
	      $galleryImg.attr("style", this.getAttribute("style"));
	      $gallery.fadeIn(100);
	  });
	  $gallery.on("click", function(){
	      $gallery.fadeOut(100);
	  });
}
</script>
</html>